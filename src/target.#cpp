/**
 * wifimanager + ota test
 * 
 * Uri Shani 07/2023
*/
#include <Arduino.h>
#include <pins_config.h>
#include <ota_config.h>
#include <wifimanager_handler.hpp>
#include <EOTAUpdate.h>

// EOTAUpdate updater(UPDATE_URL, VERSION_NUMBER);
EOTAUpdate updater(UPDATE_URL, VERSION_NUMBER, UPDATE_INTERVAL);

Wifimanager_handler wifiman;

uint32_t update_checker_timer = millis();

void setup()
{
  // put your setup code here, to run once:
  // initialize the LED digital pin as an output.
  pinMode(PIN_LED, OUTPUT);
  pinMode(TRIGGER_PIN, INPUT_PULLUP);
  pinMode(TRIGGER_PIN2, INPUT_PULLUP);

  Serial.begin(115200);
  while (!Serial);

  delay(200);

  wifiman.setup();
}


void loop()
{
  if (millis() - update_checker_timer > 500)
  {
    Serial.printf("Checking for updates. URL: %s\r\n", UPDATE_URL);
    Serial.printf("Current version: %u\r\n", VERSION_NUMBER);
    updater.CheckAndUpdate();
    update_checker_timer = millis();
  }

  wifiman.loop_handler();

  // put your main code here, to run repeatedly
  wifiman.check_status();
}